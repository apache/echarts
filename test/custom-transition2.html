<!DOCTYPE html>
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->


<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="lib/esl.js"></script>
        <script src="lib/config.js"></script>
        <script src="lib/jquery.min.js"></script>
        <script src="lib/facePrint.js"></script>
        <script src="lib/testHelper.js"></script>
        <!-- <script src="ut/lib/canteen.js"></script> -->
        <link rel="stylesheet" href="lib/reset.css" />
    </head>
    <body>
        <style>
        </style>



        <div id="main-cluster-step"></div>









        <script>
        require(['echarts'], function (echarts) {

            // output from echarts-stat
            var originalData = [[3.275154, 2.957587], [-3.344465, 2.603513], [0.355083, -3.376585], [1.852435, 3.547351], [-2.078973, 2.552013], [-0.993756, -0.884433], [2.682252, 4.007573], [-3.087776, 2.878713], [-1.565978, -1.256985], [2.441611, 0.444826], [-0.659487, 3.111284], [-0.459601, -2.618005], [2.17768, 2.387793], [-2.920969, 2.917485], [-0.028814, -4.168078], [3.625746, 2.119041], [-3.912363, 1.325108], [-0.551694, -2.814223], [2.855808, 3.483301], [-3.594448, 2.856651], [0.421993, -2.372646], [1.650821, 3.407572], [-2.082902, 3.384412], [-0.718809, -2.492514], [4.513623, 3.841029], [-4.822011, 4.607049], [-0.656297, -1.449872], [1.919901, 4.439368], [-3.287749, 3.918836], [-1.576936, -2.977622], [3.598143, 1.97597], [-3.977329, 4.900932], [-1.79108, -2.184517], [3.914654, 3.559303], [-1.910108, 4.166946], [-1.226597, -3.317889], [1.148946, 3.345138], [-2.113864, 3.548172], [0.845762, -3.589788], [2.629062, 3.535831], [-1.640717, 2.990517], [-1.881012, -2.485405], [4.606999, 3.510312], [-4.366462, 4.023316], [0.765015, -3.00127], [3.121904, 2.173988], [-4.025139, 4.65231], [-0.559558, -3.840539], [4.376754, 4.863579], [-1.874308, 4.032237], [-0.089337, -3.026809], [3.997787, 2.518662], [-3.082978, 2.884822], [0.845235, -3.454465], [1.327224, 3.358778], [-2.889949, 3.596178], [-0.966018, -2.839827], [2.960769, 3.079555], [-3.275518, 1.577068], [0.639276, -3.41284]];
            var allStepsData = [{
                "clusterAssment":[[0,11.897518219790832],[1,0.6802138252635731],[0,13.390339526159327],[0,11.752691481115326],[1,1.3537646443055726],[0,6.098722748100828],[0,16.778555382575323],[1,0.2201162719580729],[0,9.90729312281183],[0,1.523748448197578],[1,5.280700404231374],[0,10.67860098859633],[0,5.781994590986328],[1,0.16789088367317268],[0,20.463190272942075],[0,9.485661047651329],[1,4.936282405816574],[0,12.13409250050333],[0,13.56634178686933],[1,0.6393460451944728],[0,7.153917863932578],[0,10.62193716551208],[1,0.7506827979882728],[0,10.940191334842577],[0,24.17676856479382],[1,5.15437527464937],[0,6.224545409954078],[0,18.652700070311077],[1,0.46686031258797217],[0,17.85662279787108],[0,8.818697644645578],[1,3.540023681190772],[0,14.736302431923828],[0,18.624094438159833],[1,1.7824787797004726],[0,18.268740621749334],[0,10.05877598652608],[1,0.7439343714652724],[0,14.325317291277576],[0,13.234035980111827],[1,1.8201597674447723],[0,16.799369059971824],[0,22.481793438132076],[1,2.4995282213954733],[0,10.310327339671579],[0,7.549200151728578],[1,2.9196690264881724],[0,19.350989916774335],[0,31.84199476566082],[1,1.649711182799272],[0,12.009784471889326],[0,13.115032369602579],[1,0.2133597596522727],[0,13.325170015985327],[0,10.145798560251079],[1,0.07608981765557235],[0,13.94175832367033],[0,11.408587920871327],[1,3.1677631621970743],[0,13.228602736897578]],
                "centroids":[[1.23710375,0.17480612499999998],[-2.94737575,3.3263781000000003]],
                "pointsInCluster":[[[3.275154,2.957587],[0.355083,-3.376585],[1.852435,3.547351],[-0.993756,-0.884433],[2.682252,4.007573],[-1.565978,-1.256985],[2.441611,0.444826],[-0.459601,-2.618005],[2.17768,2.387793],[-0.028814,-4.168078],[3.625746,2.119041],[-0.551694,-2.814223],[2.855808,3.483301],[0.421993,-2.372646],[1.650821,3.407572],[-0.718809,-2.492514],[4.513623,3.841029],[-0.656297,-1.449872],[1.919901,4.439368],[-1.576936,-2.977622],[3.598143,1.97597],[-1.79108,-2.184517],[3.914654,3.559303],[-1.226597,-3.317889],[1.148946,3.345138],[0.845762,-3.589788],[2.629062,3.535831],[-1.881012,-2.485405],[4.606999,3.510312],[0.765015,-3.00127],[3.121904,2.173988],[-0.559558,-3.840539],[4.376754,4.863579],[-0.089337,-3.026809],[3.997787,2.518662],[0.845235,-3.454465],[1.327224,3.358778],[-0.966018,-2.839827],[2.960769,3.079555],[0.639276,-3.41284]],[[-3.344465,2.603513],[-2.078973,2.552013],[-3.087776,2.878713],[-0.659487,3.111284],[-2.920969,2.917485],[-3.912363,1.325108],[-3.594448,2.856651],[-2.082902,3.384412],[-4.822011,4.607049],[-3.287749,3.918836],[-3.977329,4.900932],[-1.910108,4.166946],[-2.113864,3.548172],[-1.640717,2.990517],[-4.366462,4.023316],[-4.025139,4.65231],[-1.874308,4.032237],[-3.082978,2.884822],[-2.889949,3.596178],[-3.275518,1.577068]]]
            }, {
                "clusterAssment":[[0,0.14546105001184495],[1,0.6802138252635731],[2,1.0218458213990822],[0,1.3454875984267451],[1,1.3537646443055726],[2,3.871675185832783],[0,0.8372599513642446],[1,0.2201162719580729],[2,3.538090574163784],[0,7.440811598535447],[1,5.280700404231374],[2,0.025667439393882528],[0,1.1194652917418453],[1,0.16789088367317268],[2,2.117342449150383],[0,1.4963520949744444],[1,4.936282405816574],[2,0.00976749868738251],[0,0.13245384486784495],[1,0.6393460451944728],[2,0.9417919241398824],[0,1.7244552311782453],[1,0.7506827979882728],[2,0.14878560390568274],[0,3.004295484273744],[1,5.15437527464937],[2,1.803164343549683],[0,2.7482578206570456],[1,0.46686031258797217],[2,1.2880771755769826],[0,1.768043561443045],[1,3.540023681190772],[2,2.125167495990783],[0,1.1481205157206449],[1,1.7824787797004726],[2,0.8794456460662823],[0,3.233154718574545],[1,0.7439343714652724],[2,2.362766306791182],[0,0.2593706162526452],[1,1.8201597674447723],[2,2.1059904998015826],[0,2.945676024420844],[1,2.4995282213954733],[2,1.5495726910016816],[0,0.945169632676145],[1,2.9196690264881724],[2,1.1385113858209823],[0,5.094764616849444],[1,1.649711182799272],[2,0.19893495138028242],[0,1.5030159274814452],[1,0.2133597596522727],[2,2.160054164348682],[0,2.6346289367371463],[1,0.07608981765557235],[2,0.26019828774538256],[0,0.0030541659057449935],[1,3.1677631621970743],[2,1.6103999993789824]],
                "centroids":[[2.93386365,3.12782785],[-2.94737575,3.3263781000000003],[-0.45965614999999993,-2.7782156000000002]],
                "pointsInCluster":[[[3.275154,2.957587],[1.852435,3.547351],[2.682252,4.007573],[2.441611,0.444826],[2.17768,2.387793],[3.625746,2.119041],[2.855808,3.483301],[1.650821,3.407572],[4.513623,3.841029],[1.919901,4.439368],[3.598143,1.97597],[3.914654,3.559303],[1.148946,3.345138],[2.629062,3.535831],[4.606999,3.510312],[3.121904,2.173988],[4.376754,4.863579],[3.997787,2.518662],[1.327224,3.358778],[2.960769,3.079555]],[[-3.344465,2.603513],[-2.078973,2.552013],[-3.087776,2.878713],[-0.659487,3.111284],[-2.920969,2.917485],[-3.912363,1.325108],[-3.594448,2.856651],[-2.082902,3.384412],[-4.822011,4.607049],[-3.287749,3.918836],[-3.977329,4.900932],[-1.910108,4.166946],[-2.113864,3.548172],[-1.640717,2.990517],[-4.366462,4.023316],[-4.025139,4.65231],[-1.874308,4.032237],[-3.082978,2.884822],[-2.889949,3.596178],[-3.275518,1.577068]],[[0.355083,-3.376585],[-0.993756,-0.884433],[-1.565978,-1.256985],[-0.459601,-2.618005],[-0.028814,-4.168078],[-0.551694,-2.814223],[0.421993,-2.372646],[-0.718809,-2.492514],[-0.656297,-1.449872],[-1.576936,-2.977622],[-1.79108,-2.184517],[-1.226597,-3.317889],[0.845762,-3.589788],[-1.881012,-2.485405],[0.765015,-3.00127],[-0.559558,-3.840539],[-0.089337,-3.026809],[0.845235,-3.454465],[-0.966018,-2.839827],[0.639276,-3.41284]]]
            }, {
                "clusterAssment":[[0,0.14546105001184495],[1,0.6802138252635731],[3,0.00026405916653086725],[0,1.3454875984267451],[1,1.3537646443055726],[2,2.0268449766387184],[0,0.8372599513642446],[1,0.2201162719580729],[2,1.2853602661590824],[0,7.440811598535447],[1,5.280700404231374],[2,0.544202924578992],[0,1.1194652917418453],[1,0.16789088367317268],[3,0.7997316188825317],[0,1.4963520949744444],[1,4.936282405816574],[2,0.5924514081707193],[0,0.13245384486784495],[1,0.6393460451944728],[3,0.9800238578019748],[0,1.7244552311782453],[1,0.7506827979882728],[2,0.20225628303871904],[0,3.004295484273744],[1,5.15437527464937],[2,0.9467852169183552],[0,2.7482578206570456],[1,0.46686031258797217],[2,0.6597495889159011],[0,1.768043561443045],[1,3.540023681190772],[2,0.4559035664663553],[0,1.1481205157206449],[1,1.7824787797004726],[2,1.0422484993528103],[0,3.233154718574545],[1,0.7439343714652724],[3,0.2935333914616421],[0,0.2593706162526452],[1,1.8201597674447723],[2,0.6034600788750825],[0,2.945676024420844],[1,2.4995282213954733],[3,0.29707180936419747],[0,0.945169632676145],[1,2.9196690264881724],[3,1.0669415687764199],[0,5.094764616849444],[1,1.649711182799272],[3,0.3086412684625307],[0,1.5030159274814452],[1,0.2133597596522727],[3,0.24922829368919752],[0,2.6346289367371463],[1,0.07608981765557235],[2,0.31497310334235556],[0,0.0030541659057449935],[1,3.1677631621970743],[3,0.08359135682519753]],
                "centroids":[[2.93386365,3.12782785],[-2.94737575,3.3263781000000003],[-1.1261616363636364,-2.3019356363636363],[0.3549616666666667,-3.3603355555555554]],
                "pointsInCluster":[[[3.275154,2.957587],[1.852435,3.547351],[2.682252,4.007573],[2.441611,0.444826],[2.17768,2.387793],[3.625746,2.119041],[2.855808,3.483301],[1.650821,3.407572],[4.513623,3.841029],[1.919901,4.439368],[3.598143,1.97597],[3.914654,3.559303],[1.148946,3.345138],[2.629062,3.535831],[4.606999,3.510312],[3.121904,2.173988],[4.376754,4.863579],[3.997787,2.518662],[1.327224,3.358778],[2.960769,3.079555]],[[-3.344465,2.603513],[-2.078973,2.552013],[-3.087776,2.878713],[-0.659487,3.111284],[-2.920969,2.917485],[-3.912363,1.325108],[-3.594448,2.856651],[-2.082902,3.384412],[-4.822011,4.607049],[-3.287749,3.918836],[-3.977329,4.900932],[-1.910108,4.166946],[-2.113864,3.548172],[-1.640717,2.990517],[-4.366462,4.023316],[-4.025139,4.65231],[-1.874308,4.032237],[-3.082978,2.884822],[-2.889949,3.596178],[-3.275518,1.577068]],[[-0.993756,-0.884433],[-1.565978,-1.256985],[-0.459601,-2.618005],[-0.551694,-2.814223],[-0.718809,-2.492514],[-0.656297,-1.449872],[-1.576936,-2.977622],[-1.79108,-2.184517],[-1.226597,-3.317889],[-1.881012,-2.485405],[-0.966018,-2.839827]],[[0.355083,-3.376585],[-0.028814,-4.168078],[0.421993,-2.372646],[0.845762,-3.589788],[0.765015,-3.00127],[-0.559558,-3.840539],[-0.089337,-3.026809],[0.845235,-3.454465],[0.639276,-3.41284]]]
            }, {
                "clusterAssment":[[4,0.7351095338720867],[1,0.6802138252635731],[3,0.00026405916653086725],[4,0.6574887550938013],[1,1.3537646443055726],[2,2.0268449766387184],[4,0.20236519991694363],[1,0.2201162719580729],[2,1.2853602661590824],[0,4.081776185534029],[1,5.280700404231374],[2,0.544202924578992],[4,1.6054276274352302],[1,0.16789088367317268],[3,0.7997316188825317],[0,0.003668511655694446],[1,4.936282405816574],[2,0.5924514081707193],[4,0.04268877169580105],[1,0.6393460451944728],[3,0.9800238578019748],[4,1.0476185469562294],[1,0.7506827979882728],[2,0.20225628303871904],[4,3.5040248192766565],[1,5.15437527464937],[2,0.9467852169183552],[4,1.329111672240801],[1,0.46686031258797217],[2,0.6597495889159011],[0,0.022928056907361136],[1,3.540023681190772],[2,0.4559035664663553],[4,1.5660879063652293],[1,1.7824787797004726],[2,1.0422484993528103],[4,2.338390101633659],[1,0.7439343714652724],[3,0.2935333914616421],[4,0.001663831518372481],[1,1.8201597674447723],[2,0.6034600788750825],[0,3.0074173782706937],[1,2.4995282213954733],[3,0.29707180936419747],[0,0.1991765105943612],[1,2.9196690264881724],[3,1.0669415687764199],[4,4.640406688953228],[1,1.649711182799272],[3,0.3086412684625307],[0,0.34290491674869467],[1,0.2133597596522727],[3,0.24922829368919752],[4,1.8246253388202298],[1,0.07608981765557235],[2,0.31497310334235556],[4,0.3175650717175153],[1,3.1677631621970743],[3,0.08359135682519753]],
                "centroids":[[3.565365,2.1237998333333334],[-2.94737575,3.3263781000000003],[-1.1261616363636364,-2.3019356363636363],[0.3549616666666667,-3.3603355555555554],[2.6632202142857144,3.5581255714285716]],
                "pointsInCluster":[[[2.441611,0.444826],[3.625746,2.119041],[3.598143,1.97597],[4.606999,3.510312],[3.121904,2.173988],[3.997787,2.518662]],[[-3.344465,2.603513],[-2.078973,2.552013],[-3.087776,2.878713],[-0.659487,3.111284],[-2.920969,2.917485],[-3.912363,1.325108],[-3.594448,2.856651],[-2.082902,3.384412],[-4.822011,4.607049],[-3.287749,3.918836],[-3.977329,4.900932],[-1.910108,4.166946],[-2.113864,3.548172],[-1.640717,2.990517],[-4.366462,4.023316],[-4.025139,4.65231],[-1.874308,4.032237],[-3.082978,2.884822],[-2.889949,3.596178],[-3.275518,1.577068]],[[-0.993756,-0.884433],[-1.565978,-1.256985],[-0.459601,-2.618005],[-0.551694,-2.814223],[-0.718809,-2.492514],[-0.656297,-1.449872],[-1.576936,-2.977622],[-1.79108,-2.184517],[-1.226597,-3.317889],[-1.881012,-2.485405],[-0.966018,-2.839827]],[[0.355083,-3.376585],[-0.028814,-4.168078],[0.421993,-2.372646],[0.845762,-3.589788],[0.765015,-3.00127],[-0.559558,-3.840539],[-0.089337,-3.026809],[0.845235,-3.454465],[0.639276,-3.41284]],[[3.275154,2.957587],[1.852435,3.547351],[2.682252,4.007573],[2.17768,2.387793],[2.855808,3.483301],[1.650821,3.407572],[4.513623,3.841029],[1.919901,4.439368],[3.914654,3.559303],[1.148946,3.345138],[2.629062,3.535831],[4.376754,4.863579],[1.327224,3.358778],[2.960769,3.079555]]]
            }, {
                "clusterAssment":[[4,0.7351095338720867],[5,0.5255085113116279],[3,0.00026405916653086725],[4,0.6574887550938013],[1,0.8136916243347753],[2,2.0268449766387184],[4,0.20236519991694363],[5,0.41325733727555103],[2,1.2853602661590824],[0,4.081776185534029],[1,1.3060240218397752],[2,0.544202924578992],[4,1.6054276274352302],[5,0.57628243638732],[3,0.7997316188825317],[0,0.003668511655694446],[5,3.9604024281532437],[2,0.5924514081707193],[4,0.04268877169580105],[5,0.1860450860032431],[3,0.9800238578019748],[4,1.0476185469562294],[1,0.100758524976204],[2,0.20225628303871904],[4,3.5040248192766565],[5,3.2738939842870103],[2,0.9467852169183552],[4,1.329111672240801],[5,0.4856940488658579],[2,0.6597495889159011],[0,0.022928056907361136],[5,2.7570516241944727],[2,0.4559035664663553],[4,1.5660879063652293],[1,0.6122047450059189],[2,1.0422484993528103],[4,2.338390101633659],[1,0.14374212687448987],[3,0.2935333914616421],[4,0.001663831518372481],[1,0.18163076255191818],[2,0.6034600788750825],[0,3.0074173782706937],[5,1.1537480794830117],[3,0.29707180936419747],[0,0.1991765105943612],[5,2.056698082415395],[3,1.0669415687764199],[4,4.640406688953228],[1,0.4141139617814904],[3,0.3086412684625307],[0,0.34290491674869467],[5,0.4130770968307042],[3,0.24922829368919752],[4,1.8246253388202298],[5,0.5762591299150887],[2,0.31497310334235556],[4,0.3175650717175153],[5,3.0216882838313217],[3,0.08359135682519753]],
                "centroids":[[3.565365,2.1237998333333334],[-1.7657655714285714,3.3979401428571427],[-1.1261616363636364,-2.3019356363636363],[0.3549616666666667,-3.3603355555555554],[2.6632202142857144,3.5581255714285716],[-3.5836273846153848,3.2878446923076927]],
                "pointsInCluster":[[[2.441611,0.444826],[3.625746,2.119041],[3.598143,1.97597],[4.606999,3.510312],[3.121904,2.173988],[3.997787,2.518662]],[[-2.078973,2.552013],[-0.659487,3.111284],[-2.082902,3.384412],[-1.910108,4.166946],[-2.113864,3.548172],[-1.640717,2.990517],[-1.874308,4.032237]],[[-0.993756,-0.884433],[-1.565978,-1.256985],[-0.459601,-2.618005],[-0.551694,-2.814223],[-0.718809,-2.492514],[-0.656297,-1.449872],[-1.576936,-2.977622],[-1.79108,-2.184517],[-1.226597,-3.317889],[-1.881012,-2.485405],[-0.966018,-2.839827]],[[0.355083,-3.376585],[-0.028814,-4.168078],[0.421993,-2.372646],[0.845762,-3.589788],[0.765015,-3.00127],[-0.559558,-3.840539],[-0.089337,-3.026809],[0.845235,-3.454465],[0.639276,-3.41284]],[[3.275154,2.957587],[1.852435,3.547351],[2.682252,4.007573],[2.17768,2.387793],[2.855808,3.483301],[1.650821,3.407572],[4.513623,3.841029],[1.919901,4.439368],[3.914654,3.559303],[1.148946,3.345138],[2.629062,3.535831],[4.376754,4.863579],[1.327224,3.358778],[2.960769,3.079555]],[[-3.344465,2.603513],[-3.087776,2.878713],[-2.920969,2.917485],[-3.912363,1.325108],[-3.594448,2.856651],[-4.822011,4.607049],[-3.287749,3.918836],[-3.977329,4.900932],[-4.366462,4.023316],[-4.025139,4.65231],[-3.082978,2.884822],[-2.889949,3.596178],[-3.275518,1.577068]]]
            }];

            var colorAll = [
                '#bbb', '#37A2DA', '#e06343', '#37a354', '#b55dba', '#b5bd48', '#8378EA', '#96BFFF'
            ];
            var ANIMATION_DURATION_UPDATE = 1500;

            // probably we should PR to echarts-stat to make the result directly.
            function preprocessRawData(originalData, allStepsData) {
                var pointIdxMap = {};
                var result = [];

                function getKey(point) {
                    return point[0] + '_' + point[1];
                }

                var stepResult = {
                    points: []
                };
                result.push(stepResult);
                for (var i = 0; i < originalData.length; i++) {
                    var point = originalData[i];
                    var key = getKey(point);
                    if (pointIdxMap[key] != null) {
                        // It's not correct to throw error but for
                        // simplicit in this certain data we just do it.
                        throw Error(key);
                    }
                    var ptsIdx = pointIdxMap[key] = stepResult.points.length;
                    stepResult.points[ptsIdx] = [point[0], point[1], 0];
                }

                for (var stepIdx = 0; stepIdx < allStepsData.length; stepIdx++) {
                    var stepData = allStepsData[stepIdx];
                    var ptsInCluster = stepData.pointsInCluster;
                    var newestClusterIdx = ptsInCluster.length - 1;

                    var stepResult = {
                        centroids: stepData.centroids,
                        points: [],
                        newestClusterIndex: newestClusterIdx,
                        newestClusterMaxAssessmentIndex: -1
                    };
                    result.push(stepResult);


                    for (var cIdx = 0; cIdx < ptsInCluster.length; cIdx++) {
                        var clusterPoints = ptsInCluster[cIdx];
                        for (var i = 0; i < clusterPoints.length; i++) {
                            var point = clusterPoints[i];
                            var key = getKey(point);
                            var ptsIdx = pointIdxMap[key];
                            if (ptsIdx == null) {
                                throw Error(key);
                            }
                            stepResult.points[ptsIdx] = [point[0], point[1], cIdx, newestClusterIdx];
                        }
                    }

                    var assessment = -Infinity;
                    for (var i = 0; i < stepData.clusterAssment.length; i++) {
                        var assessmentRecord = stepData.clusterAssment[i];
                        if (assessmentRecord[0] === newestClusterIdx && assessmentRecord[1] > assessment) {
                            assessment = assessmentRecord[1];
                            stepResult.newestClusterMaxAssessmentIndex = i;
                        }
                    }
                }
                return result;
            }

            function renderItemPoint(params, api) {
                var coord = api.coord([api.value(0), api.value(1)]);
                var clusterIdx = api.value(2);
                var isNewCluster = clusterIdx === api.value(3);

                var extra = {
                    transition: []
                };

                var contentColor = colorAll[clusterIdx];
                addColorTransition(extra, contentColor, 'content');
                // var borderColor = isNewCluster ? '#333' : '#fff';
                // addColorTransition(shape, borderColor, 'border');

                return {
                    type: 'circle',
                    x: coord[0],
                    y: coord[1],
                    // scaleX: isNewCluster ? 1.2 : 1,
                    // scaleY: isNewCluster ? 1.2 : 1,
                    // transition: ['scaleX', 'scaleY'],
                    shape: {
                        cx: 0,
                        cy: 0,
                        r: 10
                    },
                    extra: extra,
                    style: {
                        fill: contentColor,
                        stroke: '#333',
                        lineWidth: 1,
                        shadowColor: contentColor,
                        shadowBlur: isNewCluster ? 12 : 0,
                        transition: 'shadowBlur'
                    },
                    during: function (apiDuring) {
                        var currContentColor = getColorInTransition(apiDuring, 'content');
                        apiDuring.setStyle('fill', currContentColor);
                        // var currBorderColor = getColorInTransition(apiDuring, 'border');
                        // apiDuring.setStyle('stroke', currBorderColor);
                    }
                };
            }

            function addColorTransition(shape, targetColor, key) {
                var colorRGBA = echarts.color.parse(targetColor);
                shape[key + 'R'] = colorRGBA[0];
                shape[key + 'G'] = colorRGBA[1];
                shape[key + 'B'] = colorRGBA[2];
                shape[key + 'A'] = colorRGBA[3];
                var transition = shape.transition || (shape.transition = []);
                transition.push(key + 'R', key + 'G', key + 'B', key + 'A');
            }

            function getColorInTransition(apiDuring, key) {
                var colorArr = [
                    apiDuring.getExtra(key + 'R'),
                    apiDuring.getExtra(key + 'G'),
                    apiDuring.getExtra(key + 'B'),
                    apiDuring.getExtra(key + 'A')
                ];
                return echarts.color.stringify(colorArr, 'rgba');
            }

            function renderBoundary(params, api) {
                var center = api.coord([api.value(2), api.value(3)]);
                var endP = api.coord([api.value(0), api.value(1)]);
                var diffX = center[0] - endP[0];
                var diffY = center[1] - endP[1];
                var radius = Math.pow(diffX * diffX + diffY * diffY, 0.5) + 10;
                var newCluIdx = api.value(4);

                return {
                    type: 'circle',
                    shape: {
                        cx: 0,
                        cy: 0,
                        r: 0
                    },
                    extra: {
                        cxNext: isNaN(center[0]) ? 0 : center[0],
                        cyNext: isNaN(center[1]) ? 0 : center[1],
                        rNext: isNaN(radius) ? 0 : radius,
                        renderNumber: ++renderNumber,
                        transition: 'renderNumber'
                    },
                    style: {
                        fill: null,
                        stroke: '#bbb',
                        lineDash: [5, 5],
                        lineWidth: 3,
                        // opacity: 0
                    },
                    during: function (apiDuring) {
                        var currNum = apiDuring.getExtra('renderNumber');
                        if (apiDuring.getStyle('opacity') < 0.9) {
                            apiDuring
                                .setShape('cx', apiDuring.getExtra('cxNext'))
                                .setShape('cy', apiDuring.getExtra('cyNext'))
                                .setShape('r', apiDuring.getExtra('rNext'));
                        }
                        apiDuring.setStyle('opacity', 1 - (renderNumber - currNum));
                    }
                };

                // return {
                //     type: 'group',
                //     children: [{
                //         type: 'circle',
                //         shape: {
                //             cx: 0,
                //             cy: 0,
                //             r: 0,
                //         },
                //         extra: {
                //             renderNumber: ++renderNumber,
                //             cxNext: isNaN(center[0]) ? 0 : center[0],
                //             cyNext: isNaN(center[1]) ? 0 : center[1],
                //             rNext: isNaN(radius) ? 0 : radius,
                //             transition: 'renderNumber'
                //         },
                //         style: {
                //             fill: null,
                //             stroke: '#bbb',
                //             lineDash: [5, 5],
                //             lineWidth: 3
                //         },
                //         during: function (apiDuring) {
                //             var currNum = apiDuring.getExtra('renderNumber');
                //             var progress = 0.5 - (renderNumber - currNum);
                //             if (progress >= 0) {
                //                 apiDuring
                //                     .setShape('cx', apiDuring.getExtra('cxNext'))
                //                     .setShape('cy', apiDuring.getExtra('cyNext'))
                //                     .setShape('r', apiDuring.getExtra('rNext'));
                //             }
                //             var opacity = Math.abs(progress) / 0.5;
                //             apiDuring.setStyle('opacity', opacity);
                //         }
                //     }, {
                //         type: 'circle',
                //         shape: {
                //             cx: 0,
                //             cy: 0,
                //             r: 0,
                //         },
                //         extra: {
                //             renderNumber: ++renderNumber,
                //             cxNext: isNaN(center[0]) ? 0 : center[0],
                //             cyNext: isNaN(center[1]) ? 0 : center[1],
                //             rNext: isNaN(radius) ? 0 : radius,
                //             transition: 'renderNumber'
                //         },
                //         style: {
                //             fill: null,
                //             stroke: '#bbb',
                //             lineDash: [5, 5],
                //             lineWidth: 3
                //         },
                //         during: function (apiDuring) {
                //             var currNum = apiDuring.getExtra('renderNumber');
                //             var progress = 0.5 - (renderNumber - currNum);
                //             if (progress >= 0) {
                //                 apiDuring
                //                     .setShape('cx', apiDuring.getExtra('cxNext'))
                //                     .setShape('cy', apiDuring.getExtra('cyNext'))
                //                     .setShape('r', apiDuring.getExtra('rNext'));
                //             }
                //             var opacity = Math.abs(progress) / 0.5;
                //             apiDuring.setStyle('opacity', opacity);
                //         }
                //     }]
                // };
                // return {
                //     type: 'circle',
                //     shape: {
                //         cx: 0,
                //         cy: 0,
                //         r: 0,
                //     },
                //     extra: {
                //         renderNumber: ++renderNumber,
                //         cxNext: isNaN(center[0]) ? 0 : center[0],
                //         cyNext: isNaN(center[1]) ? 0 : center[1],
                //         rNext: isNaN(radius) ? 0 : radius,
                //         transition: 'renderNumber'
                //     },
                //     style: {
                //         fill: null,
                //         stroke: '#bbb',
                //         lineDash: [5, 5],
                //         lineWidth: 3
                //     },
                //     during: function (apiDuring) {
                //         var currNum = apiDuring.getExtra('renderNumber');
                //         var progress = 0.5 - (renderNumber - currNum);
                //         if (progress >= 0) {
                //             apiDuring
                //                 .setShape('cx', apiDuring.getExtra('cxNext'))
                //                 .setShape('cy', apiDuring.getExtra('cyNext'))
                //                 .setShape('r', apiDuring.getExtra('rNext'));
                //         }
                //         var opacity = Math.abs(progress) / 0.5;
                //         apiDuring.setStyle('opacity', opacity);
                //     }
                // };
            }

            function makeStepOption(option, stepResult) {
                var centroids = stepResult.centroids || [];
                var points = stepResult.points;
                var newMaxAssmIdx = stepResult.newestClusterMaxAssessmentIndex;
                var newCluIdx = stepResult.newestClusterIndex;

                option.options.push({
                    series: [{
                        type: 'custom',
                        encode: {
                            tooltip: [0, 1]
                        },
                        renderItem: renderItemPoint,
                        data: points
                    }, {
                        type: 'custom',
                        renderItem: renderBoundary,
                        animationDuration: 3000,
                        data: [
                            [
                                (points[newMaxAssmIdx] || [])[0],
                                (points[newMaxAssmIdx] || [])[1],
                                (centroids[newCluIdx] || [])[0],
                                (centroids[newCluIdx] || [])[1],
                                newCluIdx
                            ]
                        ]
                    }]
                });
            }

            var renderNumber = 0;

            var option = {
                timeline: {
                    top: 'center',
                    right: 50,
                    height: 300,
                    width: 10,
                    inverse: true,
                    autoPlay: false,
                    playInterval: 2500,
                    symbol: 'none',
                    orient: 'vertical',
                    axisType: 'category',
                    label: {
                        formatter: 'step {value}',
                        position: 10
                    },
                    checkpointStyle: {
                        color: '#555',
                        borderWidth: 0,
                        animationDuration: ANIMATION_DURATION_UPDATE
                    },
                    data: []
                },
                baseOption: {
                    animationDurationUpdate: ANIMATION_DURATION_UPDATE,
                    tooltip: {
                    },
                    xAxis: {
                        type: 'value'
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [{
                        type: 'scatter'
                    }]
                },
                options: []
            };

            var processedData = preprocessRawData(originalData, allStepsData);
            for (var i = 0; i < processedData.length; i++) {
                var stepResult = processedData[i];
                makeStepOption(option, stepResult);
                option.timeline.data.push(i + '');
            }

            var chart = testHelper.create(echarts, 'main-cluster-step', {
                title: [
                    'Cluster algorithm visualization'
                ],
                height: 600,
                option: option
            });
        });
        </script>


    </body>
</html>

